# 코어 자바스크립트

## 날짜: 2020.06.02

## Part_3. 콜백 함수

## 목차

- [콜백 함수](#콜백-함수)
- [제어권](#제어권)
- [콜백 함수는 함수다](#콜백-함수는-함수다)
- [콜백 함수 내부의 this에 다른 값 바인딩하기](#콜백-함수-내부의-this에-다른-값-바인딩하기)
- [콜백 지옥과 비동기 제어](#콜백-지옥과-비동기-제어)
- [정리](#정리)

### 콜백 함수

- **콜백 함수(callback function)은 다른 코드의 인자로 넘겨주는 함수**를 맗한다.
- "어떤 함수 A를 호출하면서 특정 조건일때 함수 B를 수행하라라는 요청"을 같이 보내는 것이라 생각하면 된다.
- 콜백 함수는 다른 코드(함수 또는 메서드)에게 인자로 넘겨줌으로서 해당 함수의 제어권을 다른 코드에 넘겨준것이다. 이 콜백 함수를 넘겨받은 함수는 코드에 따라서 적절한 로직, 시점에 함수를 실행하는 것이다.

### 제어권

``` js
setTimeout(function(){ alert("Hello"); }, 3000);

// setTimeout은 첫번째 인자로 함수를 넘겨 받는다.
// 이걸 바로 콜백 함수라 생각할 수 있다.
// 해당 코드는 3000ms를 기다린 후 Hello를 출력한다.
```

- **제어권은 함수를 어떤 시점, 어떤 인자를 넘길것인지를 결정하는 것**이라 생각하자.
- **setTimeout()**을 호출하는 것은 사용자이다. 하지만 **setTimeout()**에 넘겨준 함수를 호출하는 것은 **setTimeout()**이 되는 것이며 제어권 또한 **setTimeout()**이 가지고 있는것이다.
- 콜백 함수의 제어권을 넘겨받은 코드는 콜백 함수를 호출할 때 인자에 어떤 값들을 어떤 순서로 넘길것인지를 제어하는 제어권을 갖고 있는 것이다.
- 콜백 함수도 결국은 함수이기 때문에 기본적으로 this에는 전역객체를 참조한다. 다만 콜백 함수에 별도의 this가 될 대상을 넘기면 콜백 함수는 해당 값을 참조 한다.

### 콜백 함수는 함수다

- **콜백 함수로 어떤 객체의 메서드를 전달하더라도 그 메서드는 메서드가 아닌 함수로서 호출 된다.**

  ``` js
  var obj = {
    a: 1,
    b: 2,
    test: function() {
      console.log(this);
    }
  }
  
  obj.test() // { a: 1, b: 2, test: ...}  Object
  [1, 2].forEach(obj.test);  // 전역객체
  ```

### 콜백 함수 내부의 this에 다른 값 바인딩하기

- 객체의 메서드를 콜백 함수로 전달하더라도 이는 함수로 호출되기 때문에 해당 객체를 this로 바라볼 수 없다.
- 위 문제를 해결하기 위해서 this를 다른 변수에 담아서 콜백 함수로 활용할 함수에 this 대신 그 변수를 사용하고, 이를 클로저로 만드는 방식이 많이 사용 되었다.

  ``` js
  var obj = {
    a: 1,
    b: 2,
    test: function() {
      var self = this;
      return function() {
        console.log(self);
      }
    },
  };

  var callback = obj.test();
  setTimeout(callback, 1000); // 1초뒤에 { a: 1, b: 2, test: ... } Object가 출력된다.
  ```
  
  - 하지만 이방식은 불편하기 그지 없다. 게다가 코드도 복잡하다. 이런 방법이 있다고만 기억하고 다른 방법을 사용하자.
  
  ``` js
  var obj = {
    a: 1,
    b: 2,
    test: function() {
      console.log(this);
    },
  };

  setTimeout(obj.test.bind(obj), 1000); // 1초뒤에 { a: 1, b: 2, test: ... } Object가 출력된다.
  ```

  - bind 메서드를 사용하면 코드가 훨씬 간결해진다.

### 콜백 지옥과 비동기 제어

### 정리