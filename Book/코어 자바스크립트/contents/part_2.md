# 코어 자바스크립트

## 날짜: 2020.05.25 ~ 

## Part_1. 실행 컨텍스트

### 목차

1. [실행 컨텍스트란?](#실행-컨텍스트란)
2. [VariableEnvironment](#variableenvironment)
3. [LexicalEnvironment](#lexicalenvironment)
4. [this](#this)

#### 실행 컨텍스트란?

- *실행 컨텍스트(execution context)*는 실행할 코드에 제공할 환경 정보들을 모아놓은 객체로, 자바스크립트의 동적 언어로서의 성격을 가장 잘 파악할 수 있는 개념이다.
- *동일한 환경*에 있는 코드들을 실행할 때 필요한 환경 정보들을 모아 컨텍스트를 구성하고, 이를 *콜 스택(call stack)*에 쌓아 올렸다가, 가장 위에 쌓여 있는 컨텍스트와 관련 있는 코드들을 실행하는 식으로 전체 코드의 환경과 순서를 보장한다. 여기서 *동일한 환경*, 즉 하나의 실행 컨텍스트를 구성할 수 있는 방법으로는 다음과 같은 방법이 있다.
  - 전역공간
  - eval() 함수
  - 함수

- 다음과 같은 코드가 존재 할때 콜 스택이 어떻게 쌓이는지 살펴보자.
  
  ``` js
  // (1)
  var a = 10;
  function outer() {
    function inner() {
      console.log(a)  // undefined
      var a  = 3;
    }
    inner(); // (2)
    console.log(a);   // 1
  }
  outer();  // (3)
  console.log(a);
  ```

  1. 처음 코드를 실행하면 전역 컨텍스트가 콜스택에 담긴다. (a, inner function들이 담긴다)
  2. (3)에서 outer 함수가 호출되면서 자바스크립트 엔진은 outer에 대한 환경 정보를 수집해서 outer 실행 컨텍스트를 생성한 후 콜 스택에 담고 outer 함수의 내부 코드들을 순차적으로 실행한다.
  3. (2)에서 inner 함수가 호출되면서 마찬가지로 자바스크립트 엔진은 inner에 대한 환경 정보를 수집해서 inner 실행 컨텍스트를 생성한 후 콜 스택에 담고 inner 함수를 순차적으로 실행한다.
  4. inner 함수코드가 끝나면 inner 실행 컨텍스트가 콜 스택에서 제거 되며, 다음 콜 스택인 outer 컨텍스트가 중단됬던 (2)의 다음줄부터 실행된다.
  5. outer 함수코드가 끝나면 outer 실행 컨텍스트가 콜 스택에서 제거 되며, 다음 콜 스택인 전역 컨텍스트가 중단됬던 (3)의 다음줄 부터 실행된다.
  6. 전역 코드가 끝나면 전역 컨텍스트도 끝나고, 콜 스택에는 아무것도 남지 않는 상태로 종료된다.

  ![콜 스택](../images/call_stack.png)

- *실행 컨텍스트가 콜 스택의 맨 위에 쌓이는 순간이 곧 현재 실행할 코드에 관여하게 되는 시점임을 알 수 있다.*
- 어떤 실행 컨텍스트가 활성화될 때 자바스크립트 엔진은 해당 컨텍스트에 관련된 코드들을 실행하는 데 필요한 환경 정보들을 수집해서 실행 컨텍스트 객체에 저장한다. 이 객체는 자바스크립트 엔진이 활용할 목적으로 생성할 뿐 개발자가 코드를 통해 확인할 수는 없다.
  - *VariableEnvironment*
    - 현재 컨텍스트 내의 식별자들에 대한 정보 + 외부 환경 정보, 선언 시점의 LexicalEnvironment의 스냅샷으로, 변경 사항은 저장되지 않는다.
  - *LexicalEnvironment*
    - 처음에는 VariableEnvironment와 같지만 변경 사항이 실시간으로 반영됨
  - *ThisBinding*
    - this 식별자가 바라봐야 할 대상 객체

#### VariableEnvironment

#### LexicalEnvironment

#### this

>위 정리글은 코어 자바스크립트(Core JavaScript)에서 인용한 것입니다.

>[ISBN 979-11-5839-172-0 (93000)] Copyright 2019 by 정재남